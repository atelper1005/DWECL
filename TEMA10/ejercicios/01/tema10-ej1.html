<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Ejercicio 1 - Tema 10</title>
  </head>
  <body>
    <h1>Ejercicio 1 - Tema 10</h1>
    <select id="nombresSelect">
        <option selected disabled>Seleccione un nombre</option>
    </select>
    <div id="detalleNombre"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Obtener referencia al select y al div
        var nombresSelect = document.getElementById("nombresSelect");
        var detalleNombreDiv = document.getElementById("detalleNombre");

        // Función para cargar nombres desde el servidor
        function cargarNombres() {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function () {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
              const nombres = JSON.parse(xhttp.responseText).nombres;
              nombres.forEach((nombre) => {
                const option = document.createElement("option");
                option.textContent = nombre.nombre;
                nombresSelect.appendChild(option);
              });
            }
          };
          xhttp.open("GET", "jsonCon.php", true);
          xhttp.send();
        }

        // Función para cargar detalles de un nombre seleccionado
        function cargarDetallesNombre(nombre) {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function () {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
              const campos = JSON.parse(xhttp.responseText).campos;
              // Renderizar los campos en el div
              detalleNombreDiv.innerHTML =
                '<h2>Detalles</h2><table border="1"><tr><th>ID</th><th>Nombre</th><th>Apellidos</th><th>Ciudad</th></tr>';
              campos.forEach((campo) => {
                detalleNombreDiv.innerHTML += `<tr><td>${campo.id}</td><td>${campo.nombre}</td><td>${campo.apellidos}</td><td>${campo.ciudad}</td></tr>`;
              });
              detalleNombreDiv.innerHTML += "</table>";
            }
          };
          xhttp.open("GET", `jsonCon.php?nombre=${nombre}`, true);
          xhttp.send();
        }

        // Cargar nombres al inicio
        cargarNombres();

        // Evento al seleccionar un nombre
        nombresSelect.addEventListener("change", function () {
          const nombreSeleccionado = nombresSelect.value;
          cargarDetallesNombre(nombreSeleccionado);
        });
      });
    </script>
  </body>
</html>
